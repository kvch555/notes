#【教程主题】：1.系统管理命令
#【课程录制】： 创E
#【主要内容】
##【1.1】用户和组管理
　　在Linux操作系统中，任何文件都归属于某一特定的用户，而任何用户都隶属于至少一个用户组。用户是否有权限对某文件进行访问、读写以及执行，受到系统严格约束的正是这种清晰、严谨的用户与用户组管理系统。在很大程度上它保证了Linux系统的安全性。本节课将对Linux系统中重要的用户和组管理文件进行介绍，并且介绍如何使用命令行对用户和组进行管理。 
###Linux帐号分类
####	用户帐号
　　用来储存单一用户的数据，你可以使用一个用户帐号，来储存某一个用户的数据
#####用户帐号分为：
######　　1.　超级用户
>　　　拥有完全控制功能，用户名称通常为root，其UID（用户系统标识符）为0
######　　2.　普通用户
######　　　　分类：　　
######　　　　　　系统账号
> 　　　　　这种类型账号提供给Linux系统本身使用。在某些软件执行时候，需要你提供一个普通用户类型的账号。为了满足这个需求而建立的账号，我们称为系统账号。 在Red Hat Enterprise Linux 中，系统用户的UID在1到499之间。
######　　　　　　真实用户
> 　　　　　真实账号在系统中，被分配的UID范围为500至4,294,967,295之间。
####群组账号
　　用来储存多个用户的信息，每一个群组账号可以用来记录一组用户的数据。
#####群组账号分类：
######　　1.　超级用户组
> 　root的用户群组我们称为超级用户组  
> 　超级用户群组的GID（群组标识符）为0。隶属于超级用户群的成员，不具备系统管理的权利。
######　　2.　系统群组
> 　与系统账号一样，系统群组也是给Red Hat Enterprise Linux 系统本身，或是某个软件使用。  
> 　目前Red Hat Enterprise Linux定义系统群组的GID范围为1到499之间。
######　　3.　用户自定义组
> 　除了上述的群组外其余的所有群组都是用户自定义群组。  
>　 用户自定义组账号可使用的GID范围为500到4,294,967,293  

###用户账号文件——passwd 
　　/etc/passwd文件是UNIX安全的关键文件之一。该文件用于用户登录时校验用户的登录名、加密的口令数据项、用户ID（UID）、默认的用户组ID（GID）、用户信息、用户主目录以及登录后使用的shell。/etc/passwd文件的每一行保存一个用户的资料，而用户数据按域以冒号“:”分隔。
 　　　格式如下所示：  
<pre>   username:password:uid:gid:userinfo:home:shell</pre>
其中，各个域的含义如表所示：  
/etc/passwd文件中域的含义
<table>
	<tr>
		<th width="100">域</th>
		<th width="500">含义</th>
	</tr>
	<tr>
		<td align="center">username</td>
		<td align="center">登录名</td>
	</tr>
	<tr>
		<td align="center">password</td>
		<td align="center">加密的用户口令</td>
	</tr>
	<tr>
		<td align="center">uid</td>
		<td align="center">用户ID</td>
	</tr>
	<tr>
		<td align="center">gid</td>
		<td align="center">用户组ID</td>
	</tr>
	<tr>
		<td align="center">userinfo</td>
		<td align="center">用户信息</td>
	</tr>
	<tr>
		<td align="center">home</td>
		<td align="center">分配给用户的主目录</td>
	</tr>
	<tr>
		<td align="center">shell</td>
		<td align="center">用户登录后将执行的shell（若为空格则默认为/bin/sh）</td>
	</tr>
<table>
<br/>
　　用户的登录名是用户用来登录的识别，由用户自行选定，主要由方便用户记忆或者具有一定含义的字符串组成。所有用户口令的存放都是加密的，通常采用的是不可逆的加密算法。一般来说，用户的UID应当是独一无二的，其他用户不应当有相同的UID数值，只有UID等于0时可以例外。每个用户都需要保存专属于自己的配置文件及其他文档，以免用户间相互干扰。当用户登录进入系统时，会启动一个Shell程序，默认是bash。


###用户影子文件——shadow
　　Linux使用不可逆的加密算法（如MD5，SHA1等）来加密口令。和/etc/passwd类似，/etc/shadow文件中每条记录用冒号“:”分隔，形成9个域，格式如下所示：  
<pre>　　username:password:lastchg:min:max:warn:inactive:expire:flag</pre>
其中，各个域的含义如表所示：
/etc/shadow文件中域的含义　　
<table>
	<tr>
		<th width="100">域</th>
		<th width="500">含义</th>
	</tr>
	<tr>
		<td align="center">username</td>
		<td align="center">用户登录名 </td>
	</tr>
	<tr>
		<td align="center">password</td>
		<td align="center">加密的用户口令</td>
	</tr>
	<tr>
		<td align="center">lastchg</td>
		<td align="center">表示从1970年1月1日起到上次修改口令所经过的天数 </td>
	</tr>
	<tr>
		<td align="center">min</td>
		<td align="center">表示两次修改口令之间至少经过的天数</td>
	</tr>
	<tr>
		<td align="center">max</td>
		<td align="center">表示口令还会有效的最大天数，如果是99999则表示永不过期</td>
	</tr>
	<tr>
		<td align="center">warn</td>
		<td align="center">表示口令失效前多少天内系统向用户发出警告</td>
	</tr>
	<tr>
		<td align="center">inactive</td>
		<td align="center">表示禁止登录前用户名还有效的天数</td>
	</tr>
	<tr>
		<td align="center">expire</td>
		<td align="center">表示用户被禁止登录的时间</td>
	</tr>
	<tr>
		<td align="center">flag</td>
		<td align="center">保留域，暂未使用</td>
	</tr>
<table>
###用户组账号文件——group和gshadow
　　/etc/passwd文件中包含着每个用户的用户组ID（GID）。  
　　/etc/group文件对用户组的许可权限的控制并不是必要的，这是因为Linux系统用来自于/etc/passwd文件的UID、GID来决定文件存取权限。  
　　用户组可以像用户一样拥有口令。  
　　/etc/group文件记录格式如下所示：  
<pre>　　group_name:group_password:group_id:group_members</pre>   
其中，各个域的含义如表所示：  
/etc/group的域及其含义
<table>
	<tr>
		<th width="100">域</th>
		<th width="500">含义</th>
	</tr>
	<tr>
		<td align="center">group_name</td>
		<td align="center">用户组名</td>
	</tr>
	<tr>
		<td align="center">group_password</td>
		<td align="center">加密后的用户组口令</td>
	</tr>
	<tr>
		<td align="center">group_id</td>
		<td align="center">用户组ID（GID）</td>
	</tr>
	<tr>
		<td align="center">group_members</td>
		<td align="center">以逗号分隔的成员用户清单</td>
	</tr>
<table>　　
<br/>
/etc/gshadow的域及其含义  
<table>
	<tr>
		<th width="100">域</th>
		<th width="500">含义</th>
	</tr>
	<tr>
		<td align="center">group_name</td>
		<td align="center">用户组名</td>
	</tr>
	<tr>
		<td align="center">group_password</td>
		<td align="center">加密后的用户组口令</td>
	</tr>
	<tr>
		<td align="center">group_members</td>
		<td align="center">以逗号分隔的成员用户清单</td>
	</tr>
<table>　
<br/>
###用户和用户组账号管理命令：
####使用useradd命令添加用户
	Linux使用useradd命令添加用户或更新新创建用户的默认信息。默认信息包括前文所述的用户账号文件所存储的用户相关信息。useradd命令的格式如下：
	useradd  [参数]   {username}
	参数：  -u  UID    用来指定UID
	       -g  GROUP  定义用户的主要群组，GROUP必须已经存在
           -G  GROUP  指定用户的次要群组，可以指定多个次要群组，每个用“,“相连
           -d HOME    指定用户的主目录
           -s SHELL   指定用户登录执行的程序
           -r         建立一个系统用户的账号
> 出于系统安全考虑，Linux系统中的每一个用户除了有其用户名外，还有其对应的用户口令。因此使用useradd命令增加时，还须用passwd命令为每一位新增加的用户设置口令。之后还可以随时用passwd命令改变自己的口令。passwd命令的格式如下：
<pre>passwd username</pre>

####使用usermod命令修改用户信息
	usermod命令用来修改使用者账号，具体的修改信息和useradd命令所添加的信息一致，这里不再一一列出。usermod命令的格式如下：
	usermod  [参数]   {username}
	参数： -u UID        修改UID
          -g  GROUP     修改主要群组名称
          -G  GROUP     修改次要群组名称
          -d  HOME      修改家目录位置
          -s  SHELL     修改可执行程序
          -l  NEWNAME   修改用户名
          -L  锁定帐号
          -U  解除锁定
####使用userdel命令删除用户
	userdel命令用来删除系统中的用户信息。userdel命令的格式如下：
	userdel  [参数]   {username}
	          参数： -r 删除用户的主目录和邮箱
####使用groupadd命令创建用户组
	groupadd命令可以以指定名称来建立新的用户组。groupadd命令的格式如下：
	groupadd  [参数]  {groupname} 
	           参数：   -g GID 指定群组账号的标识符
                       -r 指定添加的群组成为系统群组
                       -f 强制执行。一般情况下groupadd不允许建立一个与使用过的GID相同的群组账号，使用这个参数就会建立相同的GID群组账号
####使用groupmod命令修改用户组属性
	groupmod命令用来修改用户组信息。groupmod命令的格式如下：
	groupmod  [参数] {groupname} 
	           参数：    -g GID  修改GID
                        -n NEWNAME   修改群组的名称
####使用groupdel命令删除用户组
	groupdel命令比较简单，用来删除系统中存在的用户组。使用该命令时必须确认待删除的用户组存在。groupdel命令的格式如下。
	groupdel groupname 
<br/>
##【1.2】用户权限管理
###Linux系统中三种基本权限
用户属主、用户属组及其它人权限
<pre>
-rw-r--r-- 1 root root 762 11-11 20:34 a.out
文件类型和权限   链接数 文件拥有者 文件拥有组 内容大小 更改时间 文件名
</pre>
<table>
	<tr>
		<th width="300">文件类型</th>
		<th width="200">ls命令中的缩写</th>
		<th width="300">应用</th>
	</tr>
	<tr>
		<td align="center">一般文件</td>
		<td align="center">-</td>
		<td align="center">保存数据</td>
	</tr>
	<tr>
		<td align="center">目录</td>
		<td align="center">d</td>
		<td align="center">存放文件</td>
	</tr>
	<tr>
		<td align="center">符号链接</td>
		<td align="center">l</td>
		<td align="center">指向其他文件</td>
	</tr>
	<tr>
		<td align="center">字符设备节点</td>
		<td align="center">c</td>
		<td align="center">访问设备</td>
	</tr>
	<tr>
		<td align="center">块设备文件</td>
		<td align="center">b</td>
		<td align="center">访问设备</td>
	</tr>
	<tr>
		<td align="center">命名管道函数</td>
		<td align="center">P</td>
		<td align="center">进程间通信</td>
	</tr>
	<tr>
		<td align="center">套接字</td>
		<td align="center">s</td>
		<td align="center">进程间通信</td>
	</tr>
<table>　
<br/>
八进制表示法
<table>
	<tr>
		<th width="300">字符表示法</th>
		<th width="200">八进制表示法</th>
		<th width="300">含义</th>
	</tr>
	<tr>
		<td align="center">r</td>
		<td align="center">4</td>
		<td align="center">读（查看文件）</td>
	</tr>
	<tr>
		<td align="center">w</td>
		<td align="center">2</td>
		<td align="center">写（删建文件、重命名）</td>
	</tr>
	<tr>
		<td align="center">x</td>
		<td align="center">1</td>
		<td align="center">执行（进入目录）</td>
	</tr>
<table>　
<br/>
###权限管理命令
 ![](./image/img05.png)
<pre>
u    属主
g    属组
o    其他
a    所有
创建文件时，系统默认权限为666
创建目录时，系统默认权限为777
修改文件权属于chown,chgrp
chown修改属主和修改属主、属组
chown  [–R]   [属主：属组] /user   file
</pre>
####chgrp修改属组
	chgrp  group file

####谁可以修改文件的所有者和权限  
> chmod    root用户和文件的所有者  
> chgrp     root用户和文件的所有者（必须是组成员）  
> chown    只有root  
